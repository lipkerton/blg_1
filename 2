from fastapi import APIRouter
from sqlalchemy import select
# from sqlalchemy.sql import text

from .schemas import PostCreateSchema, PostSchema
from ..database import database, models


router = APIRouter()


@router.get("/p", response_model=list[PostSchema])
async def get_posts(session: database.SessionDep):
    query = select(models.Post)
    result = await session.scalars(query)
    # result = await session.execute(text("""
    #     select post_id, title, content
    #     from post
    # """))
    return result.all()


@router.get("/p/{index:int}", response_model=PostSchema)
async def get_post(index: int, session: database.SessionDep):
    query = select(models.Post).where(models.Post.post_id == index)
    result = await session.scalar(query)
    return result


@router.post("/p")
async def add_post(post: PostCreateSchema, session: database.SessionDep):
    new_post = models.Post(
        title=post.title,
        content=post.content
    )
    session.add(new_post)
    await session.commit()

